{% extends 'base.html' %}


{% block content %}
<div class="row">
    <div class="col s12 l10 offset-l1">
        <!-- 본문 영역 -->
        <div style="padding: 80px 0 30px 0; margin-bottom: 50px;">
            <h2 style="text-align: center; color: #565656;">{{ article.title }}</h2>
            <div style="text-align: right;
                        margin-top: 30px;
                        margin-right: 10px;
                        font-size: 12px;">
                <span>{{ article.created_at|date:"Y.m.d h:i A" }}</span><br />
                <a href="{% url 'accounts:profile_detail' 'kaske' %}">Kaske</a>
            </div>
        </div>
        <div style="font-size: 13px; line-height: 18px; color: #565656;">
            <p>{{ article.content }}</p>
        </div>
        <div id="tag_area" style="margin: 20px 0;">
            {% for tag in article.tag.all %}
            <div class="chip">{{ tag.name }}</div>
            {% endfor %}
        </div>
        <div id="like_button_wrapper">
            <form action="{% url 'core:article_like' article.pk %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="btn {% if did_like_article %}liked{% endif %}">추천 {{ article.liker_set.count }}</button>
            </form>
        </div>
        <!-- 본문 영역 끝 -->

        <a href="{% url 'core:article_list' %}" class="waves-effect waves-light btn">목록으로</a>

        <div style="float: right;">
            <a href="{% url 'core:article_update' article.pk %}" class="waves-effect waves-light btn">수정</a>
            <form id="article_delete_form" action="{% url 'core:article_delete' article.pk %}" method="POST" style="display: inline-block;">
                {% csrf_token %}
                <button type="submit" class="waves-effect waves-light btn">삭제</button>
            </form>
            <script>
                $('#article_delete_form').submit(function(e) {
                    if (!confirm('지우시겠습니까?')) {
                        e.preventDefault();
                    }
                });
            </script>
        </div>

        <!-- 댓글 영역 -->
        <div class="comment_area">
            <h4>댓글</h4>
            {% if can_write_comment %}
                <form id="comment_form" method="POST" data-pk="{{ article.pk }}">
                    {% csrf_token %}
                    {{ comment_form.as_p }}
                    <button type="submit" class="waves-effect waves-light btn">작성</button>
                </form>
                <script>
                    $('#comment_form').submit(function(e) {
                        e.preventDefault();
                        var pk = $(this).data('pk');
                        var content = $('#id_content').val();

                        $.post('{% url "core:comment_create_ajax" %}', {
                            pk: pk,
                            content: content
                        })
                            .done(function(r) {
                                $('.comment_area ul').append(r);
                            })
                            .fail(function() {
                                alert('오류가 발생했습니다.');
                            });
                    });
                </script>
            {% else %}
                <p>댓글을 남기실 수 없습니다. 유저당 한 글에 5번만 댓글을 달 수 있습니다.</p>
            {% endif %}
            {% if article.comment_set.exists %}
            <ul>
                {% for comment in article.comment_set.all %}
                    {% include 'core/comment.html' %}
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        <!-- 댓글 영역 끝 -->
    </div>
</div>
{% endblock %}